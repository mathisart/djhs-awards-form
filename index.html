<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>獲獎填報網站（GitHub Pages）</title>
  <style>
    :root { --border:#e5e7eb; --muted:#6b7280; }
    body { font-family: system-ui, -apple-system, "Microsoft JhengHei", sans-serif; margin: 24px; }
    .card { max-width: 860px; margin: 0 auto; padding: 20px; border: 1px solid var(--border); border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,.06); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { display: block; margin: 8px 0 6px; font-weight: 600; }
    input, textarea, select { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; }
    textarea { min-height: 96px; }
    .btn { margin-top: 10px; width: 100%; padding: 12px; font-size: 16px; border: none; border-radius: 10px; background:#0f172a; color:#fff; cursor:pointer; }
    .muted { color: var(--muted); font-size: 14px; }
    .links a { display: inline-block; margin-right: 8px; margin-bottom: 6px; }
    .ok { color:#065f46; }
    .err { color:#b91c1c; }
  </style>
</head>
<body>
  <div class="card">
    <h2>獲獎填報網站（GitHub Pages）</h2>
    <p class="muted">① 寫入《獲獎填報紀錄》 ② 追加《司儀稿》 ③ 依範本產出《學生獎懲建議表（公告）》PDF</p>

    <div class="row">
      <div>
        <label>班級</label>
        <input id="klass" placeholder="例如：912" />
      </div>
      <div>
        <label>座號</label>
        <input id="seat" type="number" min="1" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>姓名</label>
        <input id="name" />
      </div>
      <div>
        <label>頒獎日期</label>
        <input id="awardDate" type="date" />
      </div>
    </div>

    <div>
      <label>獎項名稱</label>
      <input id="award" placeholder="例如：114學年度英語朗讀比賽 佳作" />
    </div>

    <div>
      <label>得獎理由（事蹟）</label>
      <textarea id="reason" placeholder="簡述評審重點與表現亮點"></textarea>
    </div>

    <div class="row">
      <div>
        <label>典禮名稱（選填）</label>
        <input id="ceremony" placeholder="例如：校務會議頒獎、週會表揚" />
      </div>
      <div></div>
    </div>

    <div class="row">
      <div>
        <label>獎懲種類</label>
        <select id="awardType">
          <option value="嘉獎">嘉獎</option>
          <option value="小功">小功</option>
          <option value="大功">大功</option>
        </select>
      </div>
      <div>
        <label>幾支</label>
        <select id="awardCount">
          <option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
    </div>

    <p class="muted">檔名規則：學生獎懲建議表（公告）_班級-座號-姓名-獲獎原因。</p>

    <button class="btn" id="submitBtn">送出並產出文件</button>

    <div id="result" style="margin-top:18px"></div>
  </div>

  <script>
    // ── 把這個換成你的 GAS Web App URL（/exec）
    const GAS_URL = 'https://script.google.com/a/macros/st.tc.edu.tw/s/AKfycbwJzfScCjzETPZOdBVFwXzUT0C1bQFhe780piXg6OWhBarH9dos9763di-WQm_G0UAjmg/exec';

    (function(){ const iso = new Date().toISOString().slice(0,10); document.getElementById('awardDate').value = iso; })();
    const $ = id => document.getElementById(id);

    $('submitBtn').addEventListener('click', async () => {
      const payload = {
        klass: $('klass').value.trim(),
        seat: $('seat').value.trim(),
        name: $('name').value.trim(),
        award: $('award').value.trim(),
        reason: $('reason').value.trim(),
        ceremony: $('ceremony').value.trim(),
        awardDate: $('awardDate').value,
        awardType: $('awardType').value,
        awardCount: $('awardCount').value,
      };
      const required = ['klass','seat','name','award','reason','awardDate','awardType','awardCount'];
      for (const k of required) if (!String(payload[k]||'').trim()) return showMsg('請完整填寫必填欄位', true);

      toggleBtn(true);
      try {
        // 使用 x-www-form-urlencoded，避免 CORS 預檢（OPTIONS）
        const body = new URLSearchParams(payload).toString();
        const res  = await fetch(GAS_URL, { method:'POST', body });
        const ct   = res.headers.get('content-type') || '';
        const data = ct.includes('application/json') ? await res.json() : {};
        if (!data || !data.ok) throw new Error((data && data.message) ? data.message : '未知錯誤');
        showLinks(data);
      } catch (err) {
        showMsg('發生錯誤：' + (err.message || err), true);
      } finally {
        toggleBtn(false);
      }
    });

    function showLinks(d){
      $('result').innerHTML = `
        <div class="links ok">
          <p><strong>完成！</strong> 已寫入並產出文件。</p>
          <p>• 紀錄表：<a href="${d.sheetUrl}" target="_blank" rel="noopener">開啟試算表</a></p>
          <p>• 司儀稿：<a href="${d.mcDocUrl}" target="_blank" rel="noopener">Google 文件</a>｜<a href="${d.mcPdfUrl}" target="_blank" rel="noopener">PDF</a></p>
          <p>• 公告表：<a href="${d.noticeDocUrl}" target="_blank" rel="noopener">Google 文件</a>｜<a href="${d.noticePdfUrl}" target="_blank" rel="noopener">PDF</a></p>
        </div>`;
    }
    function showMsg(msg, isErr=false){ $('result').innerHTML = `<p class="${isErr?'err':'ok'}">${msg}</p>`; }
    function toggleBtn(disabled){ const btn=$('submitBtn'); btn.disabled=disabled; btn.textContent = disabled?'處理中…':'送出並產出文件'; }
  </script>
</body>
</html>
