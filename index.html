<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>獎懲名單填報與文件自動產出系統</title>
  <style>
    :root{
      --border:#e5e7eb; --muted:#6b7280; --bg:#fafafa;
      --ok:#16a34a; --ok-text:#fff; --bad:#ef4444; --bad-text:#fff;
      --primary:#2563eb; --primary-text:#fff;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,"Microsoft JhengHei",sans-serif;margin:0;background:var(--bg);color:#111}
    .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:380px 1fr;gap:20px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid var(--border);border-radius:12px}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px;justify-content:space-between}
    .card .bd{padding:16px}
    h1{font-size:18px;margin:0;display:flex;gap:8px;align-items:center}
    .status{padding:8px 12px;border-radius:999px;font-size:14px;font-weight:600;border:1px solid transparent}
    .status.ok{background:var(--ok);color:var(--ok-text)}
    .status.bad{background:var(--bad);color:var(--bad-text)}
    .muted{color:var(--muted)}
    label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
    input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;font-size:14px}
    textarea{min-height:96px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:520px){.row{grid-template-columns:1fr}}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer;font-size:14px}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:var(--primary-text)}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    /* 勾選≧2 筆時的強調樣式 */
    .btn.cta{background:var(--primary);color:#fff;border-color:var(--primary);font-size:16px;font-weight:600}
    .tbl{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .tbl th,.tbl td{padding:10px 12px;border-bottom:1px solid var(--border);font-size:14px;vertical-align:middle}
    .tbl th{background:#f8fafc;text-align:left;color:#374151}
    .tbl tr:last-child td{border-bottom:none}
    .searchbar{display:flex;gap:8px}
    .searchbar input{flex:1}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <!-- 左：表單 -->
      <div class="card">
        <div class="hd">
          <h1>新增獲獎同學</h1>
          <div id="topWarn" class="status bad">後端連線失敗</div>
        </div>
        <div class="bd">
          <form id="form">
            <label>班級</label>
            <input name="班級" placeholder="例如：701" required />
            <label>座號</label>
            <input name="座號" placeholder="例如：15" required />
            <label>姓名</label>
            <input name="姓名" placeholder="例如：王小明" required />
            <label>發生日期</label>
            <input name="發生日期" type="date" />
            <div class="row">
              <div>
                <label>事由（獲獎原因/比賽名稱）</label>
                <textarea name="事由" placeholder="例如：英語朗讀比賽"></textarea>
              </div>
              <div>
                <label>成績（名次/等第）</label>
                <input name="成績" placeholder="例如：第一名、第二名、特優、優等…" />
              </div>
            </div>
            <label>獎懲種類（僅敘獎單使用；司儀稿不使用）</label>
            <select name="獎懲種類">
              <option value="">（不敘獎）</option>
              <option>嘉獎一支</option>
              <option>嘉獎二支</option>
              <option>小功一支</option>
              <option>小功二支</option>
            </select>
            <div style="margin-top:12px">
              <button type="submit" class="btn primary">＋加入名單</button>
            </div>
          </form>
        </div>
      </div>

      <!-- 右：清單 -->
      <div class="card">
        <div class="hd">
          <h1>已填報名單（共 <span id="count">0</span> 筆）</h1>
          <div class="tools">
            <div class="searchbar">
              <input id="q" placeholder="搜尋：班級 / 姓名 / 事由 / 成績" />
              <button id="refreshBtn" class="btn">重新整理</button>
            </div>
          </div>
        </div>
        <div class="bd">
          <div style="margin-bottom:10px" class="tools">
            <button id="btnEmcee" class="btn">一鍵產出司儀稿（預覽）</button>
            <button id="btnAward" class="btn">一鍵產出敘獎單</button>
          </div>
          <table class="tbl">
            <thead>
              <tr>
                <th style="width:48px">選</th>
                <th>班級</th>
                <th>座號</th>
                <th>姓名</th>
                <th>事由</th>
                <th>成績</th>
              </tr>
            </thead>
            <tbody id="tbody">
              <tr><td colspan="6" class="muted">尚無資料</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- 司儀稿預覽 Modal -->
  <div id="backdrop" style="position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;padding:16px;">
    <div class="card" style="max-width:780px;width:100%;max-height:88vh;overflow:auto">
      <div class="hd">
        <h1 id="modalTitle">預覽</h1>
        <button id="closeModal" class="btn">關閉</button>
      </div>
      <div class="bd">
        <div id="docBody" style="line-height:1.9"></div>
        <div style="margin-top:14px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="copyBtn" class="btn">複製文字</button>
          <button id="downloadPdfBtn" class="btn">匯出PDF</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <script src="./config.js"></script>
  <script src="./app.js"></script>
</body>
</html>
